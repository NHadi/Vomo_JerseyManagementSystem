<!-- Sidenav component -->
<nav class="sidenav navbar navbar-vertical fixed-left navbar-expand-xs navbar-light bg-white" id="sidenav-main">
  <div class="scrollbar-inner">
    <!-- Brand -->
    <div class="sidenav-header">
      <a class="navbar-brand" href="javascript:void(0)">
        <img src="assets/img/brand/vomo.png" class="navbar-brand-img" alt="...">
      </a>
    </div>
    <div class="navbar-inner">
      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidenav-collapse-main">
        <!-- Nav items -->
        <ul class="navbar-nav" id="menu-container">
          <!-- Menu items will be dynamically inserted here -->
        </ul>
      </div>
    </div>
  </div>
</nav>

<script>
  $(document).ready(function() {
    const user = JSON.parse(localStorage.getItem('user'));
    const menus = JSON.parse(localStorage.getItem('menus'));
    
    if (user && menus) {
      renderMenus(menus);
    }
  });

  function renderMenus(menus) {
    const menuContainer = $('#menu-container');
    menuContainer.empty();

    menus.forEach(menu => {
      if (menu.children && menu.children.length > 0) {
        // Parent menu with dropdown
        const menuItem = `
          <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#menu-${menu.id}" aria-expanded="false">
              <i class="${menu.icon}"></i>
              <span class="nav-link-text">${menu.name}</span>
            </a>
            <div class="collapse" id="menu-${menu.id}">
              <ul class="nav nav-sm flex-column pl-4">
                ${menu.children.map(child => `
                  <li class="nav-item">
                    <a class="nav-link py-2" href="${child.url}">
                      <i class="${child.icon}"></i>
                      <span class="nav-link-text">${child.name}</span>
                    </a>
                  </li>
                `).join('')}
              </ul>
            </div>
          </li>
        `;
        menuContainer.append(menuItem);

        // Initialize collapse behavior
        $(`#menu-${menu.id}`).on('show.bs.collapse', function() {
          $(this).siblings('.nav-link').removeClass('collapsed');
          $(this).siblings('.nav-link').attr('aria-expanded', 'true');
        });

        $(`#menu-${menu.id}`).on('hide.bs.collapse', function() {
          $(this).siblings('.nav-link').addClass('collapsed');
          $(this).siblings('.nav-link').attr('aria-expanded', 'false');
        });
      } else {
        // Regular menu item
        const menuItem = `
          <li class="nav-item">
            <a class="nav-link" href="${menu.url}">
              <i class="${menu.icon}"></i>
              <span class="nav-link-text">${menu.name}</span>
            </a>
          </li>
        `;
        menuContainer.append(menuItem);
      }
    });

    // Set active menu based on current URL
    const currentPath = window.location.pathname;
    $('.nav-link').each(function() {
      const href = $(this).attr('href');
      if (href && currentPath.endsWith(href)) {
        $(this).addClass('active');
        $(this).parents('.collapse').addClass('show');
        $(this).parents('.collapse').siblings('.nav-link').removeClass('collapsed');
        $(this).parents('.collapse').siblings('.nav-link').attr('aria-expanded', 'true');
      }
    });
  }
</script>
